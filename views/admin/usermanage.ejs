<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/admin/usermanage.css">
    <title>products-manage</title>
</head>

<body>



    <div class="sidebar">
        <h2>Admin Panel</h2>
        <ul>
            <li><a href="/admin/dashboard">Dashboard</a></li>
            <li><a href="/admin/manage-user">Users</a></li>
            <li><a href="/admin/add-product">Products Add</a></li>
            <li><a href="/admin/manage/product">manage Product</a></li>
        </ul>
    </div>



    <div class="hamburger-menu">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
    </div>
<section>


    <h1>User Management</h1>
    <form action="/admin/manage-user" method="POST">
        <table>
            <thead>
                <tr>
                    <th>Number</th>
                    <th>Username</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Save</th>
                </tr>
            </thead>
            <tbody>

                <% user.forEach((user , index)=> { %>
                    <tr>
                        <td>
                            <%= index + 1 %>&nbsp;
                        </td>
                        <td>
                            <%= user.username %>&nbsp;
                        </td>

                        <td>
                            <%= user.name %>&nbsp;
                        </td>

                        <td>
                            <%= user.email %>&nbsp;
                        </td>
                        <td>
                            <select name="userRole" id="userRole<%= user._id %>">
                                <option value="Admin" <% if (user.userRole==='Admin' ) { %> selected <% } %>>Admin
                                </option>
                                <option value="User" <% if (user.userRole==='User' ) { %> selected <% } %>>User</option>
                                <option value="Guest" <% if (user.userRole==='Guest' ) { %> selected <% } %>>Guest
                                </option>
                            </select>
                        </td>
                        <td> <button onclick="updateUserRole('<%= user._id %>')">Save</button></td>

                    </tr>
                    <% }); %>
            </tbody>
        </table>
    </form>
</section>
    <!-- <script src="../javascripts/user.js"></script> -->
    <script src="../javascripts/admin/user.js"></script>
    <script>
        function updateUserRole(userId) {
            const userRoleSelect = document.getElementById(`userRole${userId}`);
            const newRole = userRoleSelect.value;

            // Send the updated role to the server using a fetch request
            fetch(`/admin/manage-user/${userId}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ newRole }),
            })
                .then(response => response.json())
                .then(data => {
                    // Handle the response from the server (e.g., display a success message)
                    console.log(data);
                })
                .catch(error => {
                    // Handle errors
                    console.error("Error:", error);
                });
        }
    </script>

</body>

</html>