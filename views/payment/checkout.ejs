<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/payment/checkout.css">
  <title>Document</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10"></link>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

</head>

<body>

  <body>
    <div class="main">

      <div class="stepper">

        <div class="progress-container">
          <div class="progress" id="progress"></div>
          <div class="circle active">1</div>
          <div class="circle">2</div>
          <div class="circle">3</div>

        </div>
      </div>
      <script> let go =  </script>
      <div class="container">
        <div class="step-container active">
          <div class="step" >
            <% if (!user) { %> <!-- If no user object exists -->
              <h2>No user found !!</h2>
              <% } else { %> <!-- If user object exists -->
                <div class="detail-container">


                  <% if (user.address==="none" ) { %> <!-- If user's address is 'none' -->
                    <span style="color: red;">Error: Address is 'none'. Please change it.</span>
                    <div class="form-container">


                      <form id="updateForm" action="/profile/<%= encodeURIComponent(user._id) %>" method="post"><label
                          for="contactNumber">Address:</label>
                        <input type="text" id="address" placeholder=" <%= user.address %>" name="address"><br><br>
                        <button id="submitaddress" value="SUBMIT" type="submit">submit</button>
                      </form>
                    </div>

                    <% } if (user.contactNumber==="none" ) { %> <!-- If user's contact number is '0' -->
                      <span style="color: red;">Error: contact is 'none'. Please change it.</span>
                      <div class="form-container">
                        <form id="updateForm" action="/profile/<%= encodeURIComponent(user._id) %>" method="post">
                          <label for="contactNumber">Contact Number:</label>
                          <input type="text" id="contactNumber" placeholder=" <%= user.contactNumber %>" maxlength="10"
                            name="contactNumber" onkeyup="validateContact() "><br><br>
                          <button id="submitaddress" value="SUBMIT" type="submit">submit</button>
                        </form>

                      </div>
                </div>
                <% } else { %>
                  <div class="detail-user">

                    <!-- If user's address and contact number are valid -->
                    <h2>
                      NAME :
                      <%= user.name %>
                    </h2>
                    <h2> CONTACT :
                      <%= user.contactNumber %>
                    </h2>
                    <h2> ADDRESS :
                      <%= user.address %>
                    </h2>

                  </div>
                  <% } %>

                    <% } %>

          </div>
          
        </div>
        <script>  go = true ; </script>
      </div>
      <div class="step-container">
        <div class="step" >
          <h2>PAY AMOUNT : RS <%= total %>
          </h2>
          <div class="bt">
            <a id="payLink" class="contBtn"  href="/payment/<%= encodeURIComponent(user._id) %>">GOT TO GATEWAY</a>
            </div>
            <% if ( paymentNull){%>
              
            <h2>your payment is pending</h2>
              <% }else{%>
          
          <% if(!paymentId){%>
            <h2>your payment is pending</h2>
            <%} else{%>
              <% if(id==paymentId.transactionId){ %>
                
                <h2>your payment is done</h2>
                <script>  go = false ; </script>
                <script>
                  let payLink = document.getElementById("payLink").style.display ="none"
                </script>
                <% } } %>
                <% }  %>
                  
        </div>
      </div>
      <div class="step-container">
        <div class="step">
          <div class="successful-container">
            <div class="tick">
              <% if(!paymentId){%>
                <h2>your payment is pending</h2>
            
                  // Replace the standard alert with SweetAlert
        
                <%} else{%>
                  <% if(id==paymentId.transactionId){ %>
                    
                    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                      <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none" stroke="#73AF55"
                        stroke-width="2" />
                      <path class="checkmark__check" fill="none" stroke="#73AF55" stroke-width="2"
                        d="M14.1 27.2l7.1 7.2 16.7-16.8" />
                    </svg>
                    <h2>Name: <span><%=paymentId.name %></span></h2>
                    <h2>Amount: <span><%=paymentId.amount %></span></h2>
                    <h2>type: <span><%=paymentId.type %></span></h2>
                    <h2>date: <span><%=paymentId.date %></span></h2>
                    <h2>transaction Id: <span><%=paymentId.transactionId %></span></h2>
                    
      
      
                    <h2>thank you ! your product will be delivered to your address</h2>
      
                    <form action="/bag/clear" method="post">
                      
                      <input class="contBtn" type="submit" value="continue">
                    </form>
                    <% } else { %>
                      <h2>Your previous transaction </h2>
                  <span>date  <%=paymentId.date %></span>
                  <%} }%>

            
            </div>
          </div>

        </div>
      </div>

    </div>

    <div class="buttons">



      <button class="btn" id="prev" disabled>Prev</button>
      <button class="btn" id="next">Next</button>
    </div>
    </div>

    <script src="/javascripts/payment/checkout.js"></script>
    <script src="/javascripts/main/profile.js"></script>

  </body>

</html>